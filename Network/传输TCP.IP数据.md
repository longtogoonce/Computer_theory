# 创建套接字
## 2.1协议栈的内部结构
> 协议栈的上半部分有两块：
> - 一部分以TCP协议来收发数据（浏览器，邮件等应用程序）
> - 一部分以UDP协议收发数据（DNS查询）
> 
>  协议栈的下一部分为IP协议：
> - IP协议负责控制网络包收发操作，在互联网中传输数据时，数据会被切割为一个一个的网络包
## 2.2套接字的实体
> 协议栈内部有一块用于存放控制信息的内存空间，记录了用于控制通信操作的控制信息，例如：IP地址，端口号，通信操作的状态
> 
> 套接字本就是一个概念而已，但我们可以理解为控制信息就是套接字实体
>
> 协议栈是根据套接字中记录的控制信息来工作的
## 2.3控制信息
> 在连接阶段，网络包中只有控制信息
>
>控制信息包括：
> - 以太网和IP的控制信息
> - TCP的控制信息
> 
> TCP的部分格式:
> - 发送与接受端口号
> - 数据顺序编号
> - ACK号
> - 数据偏移量
> - 控制位
> - 窗口
>
> 通信操作的控制信息分为两类：
> - 头部中记录的信息
> - 套接字中记录的信息
## 2.4建立连接的过程
> 1.在客户端的TCP模块创建表示连接的控制信息的头部\
> 2.将数据传递给IP模块并委托其进行发送\
> 3.网络包通过网络到达服务器\
> 4.服务器的TCP模块根据TCP头部的信息找到对应的套接字\
> 5.套接字写入相应的信息，表示正在连接\
> 6.服务器的TCP模块将TCP头部传递给IP模块，并委托IP模块向客户端返回响应
> 7.客户端确认连接状态，套接字进入随时收发数据的状态
## 2.5收发数据
> 协议栈会因为数据的长度以及计数器来把网络包发送出去
>
> 使用ACK号来确认网络包已收到
> - ACK号用于确认已经成功接收到数据的包的序号
> - ACK号还可以用于实现TCP的流量控制和拥塞控制
> 
> 控制位：
> - SYN包是由客户端发送给服务器的，用于请求建立连接并传输起始序号，而服务器在回复客户端时会发送一个ACK包，表示确认收到了客户端的SYN包，并在该ACK包中发送自己的序列号。此时，客户端再回复一个ACK包，表示确认收到服务器的确认，并发送下一个序列号。
> - FIN包则用于关闭连接。当一个端点发送FIN包时，它表示该端点已经完成了数据的发送，希望关闭连接。收到FIN包的另一个端点会发送一个ACK包表示已经收到了该FIN包。然后，它也可以发送一个FIN包来关闭连接，也可以继续发送数据直到自己准备好关闭连接。
>
> 窗口：
> - TCP采用滑动窗口来管理数据发送与ACK号操作（在等待时间中继续发包）
> - 接收方的TCP收到包后，数据会被放在缓冲区中，然后计算ACK包，将数据组装成原始的数据并传递给应用程序